<script>
	import { onMount, onDestroy } from 'svelte';
	import { paperTradingAPI } from '$lib/utils/api';

	// Engine Status
	let engineStatus = {
		running: false,
		status: 'stopped',
		mode: 'none',
		is_historical_mode: false,
		config_id: null,
		initial_capital: 0,
		current_capital: 0,
		nifty_ltp: 0,
		major_trend: '',
		minor_trend: '',
		major_timeframe: '15min',
		minor_timeframe: '1min',
		active_positions: 0,
		last_update: null,
		suspend_ce: false,
		suspend_pe: false
	};

	// Market Status
	let marketStatus = {
		is_open: false,
		current_time: '',
		is_trading_day: false,
		market_open_time: '09:15',
		market_close_time: '15:30',
		next_trading_day: null
	};

	// Performance Metrics
	let performance = {
		total_trades: 0,
		realized_pnl: 0,
		unrealized_pnl: 0,
		total_pnl: 0,
		win_rate: 0,
		avg_profit: 0,
		avg_loss: 0
	};

	// UI State
	let error = null;
	let loading = false;
	let activeTrades = [];
	let closedTrades = [];
	let alerts = [];
	let configs = [];
	let selectedConfig = null;
	let enableHistoricalMode = false;  // Checkbox for historical simulation
	let replaySpeed = 1.0;  // Speed multiplier for historical replay (1.0 = real-time)
	let selectedDate = null;  // Selected date for historical data

// Tab state
	let mainTab = 'dash';
	let activeTab = 'performance';
	let configTab = 'list';  // For configuration management

	// Configuration management
	let showConfigForm = false;
	let editingConfig = null;
	let configForm = {
		name: '',
		initial_capital: 100000,
		capital_allocation_pct: 50.0,
		ma_short_period: 7,
		ma_long_period: 20,
		major_trend_timeframe: '15min',
		minor_trend_timeframe: '1min',
		replay_speed: 1.0,
		buy_7ma_enabled: true,
		buy_7ma_percentage_below: 0.0,
		buy_7ma_target_percentage: 2.5,
		buy_7ma_stoploss_percentage: 15.0,
		buy_20ma_enabled: true,
		buy_20ma_percentage_below: 0.0,
		buy_20ma_target_percentage: 3.0,
		buy_20ma_stoploss_percentage: 15.0,
		buy_lbb_enabled: true,
		buy_lbb_percentage_below: 0.0,
		buy_lbb_target_percentage: 5.0,
		buy_lbb_stoploss_percentage: 15.0,
		lot_size: 75,
		min_strike_gap: 100,
		strike_round_to: 100,
		square_off_time: '15:28',
		square_off_enabled: true,
		exclude_expiry_day_contracts: true,
		reverse_signals: false,
		suspend_ce: false,
		suspend_pe: false
	};

	// Polling interval
	let statusInterval = null;

	onMount(async () => {
		await loadConfigs();
		await loadMarketStatus();
		await updateStatus();
		statusInterval = setInterval(updateStatus, 5000);
	});

	onDestroy(() => {
		if (statusInterval) {
			clearInterval(statusInterval);
		}
	});

	async function updateStatus() {
		try {
			const response = await paperTradingAPI.getStatus();
			engineStatus = { ...engineStatus, ...response.data };

			if (engineStatus.running && engineStatus.config_id) {
				await loadConfigDetails();
				await loadTrades();
				await loadAlerts();
			}
		} catch (err) {
			console.error('Error fetching status:', err);
		}
	}

	async function loadConfigs() {
		try {
			const response = await paperTradingAPI.getConfigs();
			configs = response.data.configs || [];
			if (configs.length > 0 && !selectedConfig) {
				selectedConfig = configs[0].id;
			}
		} catch (err) {
			console.error('Error loading configs:', err);
		}
	}

	async function loadMarketStatus() {
		try {
			const response = await fetch('http://localhost:8000/api/paper-trading/market-status');
			const result = await response.json();
			if (result.status === 'success') {
				marketStatus = result.data;
				// Auto-disable historical mode if market is open
				if (marketStatus.is_open) {
					enableHistoricalMode = false;
				}
			}
		} catch (err) {
			console.error('Error loading market status:', err);
		}
	}

	async function loadConfigDetails() {
		if (!engineStatus.config_id) return;

		try {
			const response = await paperTradingAPI.getConfig(engineStatus.config_id);
			const config = response.data;

			performance = {
				total_trades: config.total_trades || 0,
				realized_pnl: config.realized_pnl || 0,
				unrealized_pnl: 0,
				total_pnl: 0,
				win_rate: 0,
				avg_profit: 0,
				avg_loss: 0
			};
		} catch (err) {
			console.error('Error loading config details:', err);
		}
	}

	async function loadTrades() {
		if (!engineStatus.config_id) return;

		try {
			const response = await paperTradingAPI.getTrades(engineStatus.config_id);
			const trades = response.data.trades || [];

			activeTrades = trades.filter(t => t.status === 'open');
			closedTrades = trades.filter(t => t.status === 'closed').slice(0, 50);

			performance.unrealized_pnl = activeTrades.reduce((sum, t) => sum + (t.unrealized_pnl || 0), 0);
			performance.total_pnl = performance.realized_pnl + performance.unrealized_pnl;

			const closedWithPnl = closedTrades.filter(t => t.pnl !== 0);
			const winners = closedWithPnl.filter(t => t.pnl > 0);
			performance.win_rate = closedWithPnl.length > 0
				? (winners.length / closedWithPnl.length * 100).toFixed(1)
				: 0;

		} catch (err) {
			console.error('Error loading trades:', err);
		}
	}

	async function loadAlerts() {
		if (!engineStatus.config_id) return;

		try {
			const response = await paperTradingAPI.getAlerts(engineStatus.config_id);
			alerts = (response.data.alerts || []).slice(0, 100);
		} catch (err) {
			console.error('Error loading alerts:', err);
		}
	}

	async function startEngine() {
		if (!selectedConfig) {
			error = 'Please select a configuration';
			return;
		}

		loading = true;
		error = null;

		try {
			// Send historical_mode parameter to API
			const response = await fetch('http://localhost:8000/api/paper-trading/start', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					config_id: selectedConfig,
					historical_mode: enableHistoricalMode,
					replay_speed: enableHistoricalMode ? replaySpeed : 1.0,
					selected_date: enableHistoricalMode && selectedDate ? selectedDate : null
				})
			});

			if (!response.ok) {
				const errorData = await response.json();
				throw new Error(errorData.detail || 'Failed to start engine');
			}

			await updateStatus();
		} catch (err) {
			error = err.message || 'Failed to start engine';
			console.error('Error starting engine:', err);
		} finally {
			loading = false;
		}
	}

	async function stopEngine() {
		loading = true;
		error = null;

		try {
			await paperTradingAPI.stop();
			await updateStatus();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to stop engine';
			console.error('Error stopping engine:', err);
		} finally {
			loading = false;
		}
	}

	async function pauseEngine() {
		loading = true;
		error = null;

		try {
			await paperTradingAPI.pause();
			await updateStatus();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to pause engine';
			console.error('Error pausing engine:', err);
		} finally {
			loading = false;
		}
	}

	async function resumeEngine() {
		loading = true;
		error = null;

		try {
			await paperTradingAPI.resume();
			await updateStatus();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to resume engine';
			console.error('Error resuming engine:', err);
		} finally {
			loading = false;
		}
	}

	async function toggleSuspendCE(suspend) {
		try {
			await paperTradingAPI.suspendCE(suspend);
			await updateStatus();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to toggle CE suspension';
			console.error('Error toggling CE:', err);
		}
	}

	async function toggleSuspendPE(suspend) {
		try {
			await paperTradingAPI.suspendPE(suspend);
			await updateStatus();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to toggle PE suspension';
			console.error('Error toggling PE:', err);
		}
	}

	async function closePosition(tradeId) {
		if (!confirm('Are you sure you want to close this position?')) return;

		try {
			await paperTradingAPI.closePosition(tradeId);
			await loadTrades();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to close position';
			console.error('Error closing position:', err);
		}
	}

	function formatCurrency(value) {
		return new Intl.NumberFormat('en-IN', {
			style: 'currency',
			currency: 'INR',
			minimumFractionDigits: 2
		}).format(value);
	}

	function formatDateTime(dateStr) {
		if (!dateStr) return '-';
		return new Date(dateStr).toLocaleString('en-IN');
	}

	function formatTime(dateStr) {
		if (!dateStr) return '-';
		return new Date(dateStr).toLocaleTimeString('en-IN');
	}

	function getStatusColor(status) {
		const colors = {
			'running': 'text-green-600 bg-green-100',
			'paused': 'text-yellow-600 bg-yellow-100',
			'stopped': 'text-gray-600 bg-gray-100'
		};
		return colors[status] || 'text-gray-600 bg-gray-100';
	}

	function getTrendColor(trend) {
		if (!trend) return 'text-gray-500';
		return trend.toLowerCase().includes('up') ? 'text-green-600' : 'text-red-600';
	}

	function getPnLColor(pnl) {
		if (pnl > 0) return 'text-green-600';
		if (pnl < 0) return 'text-red-600';
		return 'text-gray-600';
	}

	// Configuration management functions
	async function createConfig() {
		try {
			await paperTradingAPI.createConfig(configForm);
			await loadConfigs();
			showConfigForm = false;
			resetConfigForm();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to create configuration';
			console.error('Error creating config:', err);
		}
	}

	async function updateConfig() {
		if (!editingConfig) return;
		try {
			await paperTradingAPI.updateConfig(editingConfig.id, configForm);
			await loadConfigs();
			showConfigForm = false;
			resetConfigForm();
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to update configuration';
			console.error('Error updating config:', err);
		}
	}

	async function deleteConfig(configId) {
		if (!confirm('Are you sure you want to delete this configuration? This action cannot be undone.')) return;
		try {
			await paperTradingAPI.deleteConfig(configId);
			await loadConfigs();
			if (selectedConfig === configId) {
				selectedConfig = configs.length > 0 ? configs[0].id : null;
			}
		} catch (err) {
			error = err.response?.data?.detail || 'Failed to delete configuration';
			console.error('Error deleting config:', err);
		}
	}

	function editConfig(config) {
		editingConfig = config;
		configForm = { ...config };
		showConfigForm = true;
	}

	function newConfig() {
		editingConfig = null;
		resetConfigForm();
		showConfigForm = true;
	}

	function resetConfigForm() {
		configForm = {
			name: '',
			initial_capital: 100000,
			capital_allocation_pct: 50.0,
			ma_short_period: 7,
			ma_long_period: 20,
			major_trend_timeframe: '15min',
			minor_trend_timeframe: '1min',
			replay_speed: 1.0,
			buy_7ma_enabled: true,
			buy_7ma_percentage_below: 0.0,
			buy_7ma_target_percentage: 2.5,
			buy_7ma_stoploss_percentage: 15.0,
			buy_20ma_enabled: true,
			buy_20ma_percentage_below: 0.0,
			buy_20ma_target_percentage: 3.0,
			buy_20ma_stoploss_percentage: 15.0,
			buy_lbb_enabled: true,
			buy_lbb_percentage_below: 0.0,
			buy_lbb_target_percentage: 5.0,
			buy_lbb_stoploss_percentage: 15.0,
			lot_size: 75,
			min_strike_gap: 100,
			strike_round_to: 100,
			square_off_time: '15:28',
			square_off_enabled: true,
			exclude_expiry_day_contracts: true,
			reverse_signals: false,
			suspend_ce: false,
			suspend_pe: false
		};
	}
</script>

<div class="space-y-6">
	<!-- Header -->
	<div class="flex justify-between items-center">
		<div>
			<h1 class="text-3xl font-bold text-gray-900">Paper Trade</h1>
			<p class="text-gray-600 mt-1">Real-time paper trade with live market data</p>
		</div>
		<div class="flex items-center gap-3">
			<!-- Mode Badge -->
			{#if engineStatus.running}
				<div class="px-4 py-2 rounded-lg font-semibold {
					engineStatus.is_historical_mode 
						? 'bg-purple-100 text-purple-700' 
						: 'bg-blue-100 text-blue-700'
				}">
					{engineStatus.is_historical_mode ? 'üïí HISTORICAL' : 'üì° LIVE'}
				</div>
			{/if}
			<!-- Status Badge -->
			<div class="px-4 py-2 rounded-lg {getStatusColor(engineStatus.status)} font-semibold">
				{engineStatus.status.toUpperCase()}
			</div>
		</div>
	</div>

	<!-- Main Tabs -->
	<div class="border-b border-gray-200">
		<div class="flex gap-1 p-2">
			<button
				on:click={() => mainTab = 'dash'}
				class="px-6 py-3 rounded-t-lg font-medium transition-colors {mainTab === 'dash' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}"
			>
				üè† Dashboard
			</button>
			<button
				on:click={() => mainTab = 'trades'}
				class="px-6 py-3 rounded-t-lg font-medium transition-colors {mainTab === 'trades' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}"
			>
				üìä Trades
			</button>
			<button
				on:click={() => mainTab = 'configs'}
				class="px-6 py-3 rounded-t-lg font-medium transition-colors {mainTab === 'configs' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}"
			>
				‚öôÔ∏è Configurations
			</button>
		</div>
	</div>

	<!-- Error Display -->
	{#if error}
		<div class="bg-red-50 border border-red-200 rounded-lg p-4">
			<div class="flex items-start gap-3">
				<span class="text-red-600 text-xl">‚ö†Ô∏è</span>
				<div class="flex-1">
					<h3 class="text-red-800 font-semibold">Error</h3>
					<p class="text-red-700 text-sm mt-1">{error}</p>
				</div>
				<button on:click={() => error = null} class="text-red-600 hover:text-red-800">‚úï</button>
			</div>
		</div>
	{/if}

	<!-- Dashboard Tab -->
	{#if mainTab === 'dash'}
		<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
			<!-- Controls -->
			<div class="bg-white rounded-lg shadow-md p-6">
				<h2 class="text-xl font-bold mb-4">Controls</h2>
				<div class="mb-4">
					<label for="config-select" class="block text-sm font-medium text-gray-700 mb-2">Configuration</label>
					<select
						id="config-select"
						bind:value={selectedConfig}
						disabled={engineStatus.running}
						class="w-full px-4 py-2 border rounded-lg disabled:bg-gray-100"
					>
						{#each configs as config}
							<option value={config.id}>{config.name}</option>
						{/each}
					</select>
				</div>

				<!-- Historical Simulation Mode -->
				{#if !engineStatus.running}
					<div class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
						<label class="flex items-start gap-3 cursor-pointer">
							<input
								type="checkbox"
								bind:checked={enableHistoricalMode}
								disabled={marketStatus.is_open}
								class="w-5 h-5 mt-0.5"
							/>
							<div class="flex-1">
								<span class="text-sm font-medium text-gray-900">Enable Historical Simulation</span>
								<p class="text-xs text-gray-600 mt-1">
									{#if marketStatus.is_open}
										Market is currently open - Historical mode unavailable
									{:else}
										Replay historical market data for practice (Market is closed)
									{/if}
								</p>
								{#if !marketStatus.is_trading_day && marketStatus.next_trading_day}
									<p class="text-xs text-purple-600 mt-1">
										Next trading day: {marketStatus.next_trading_day}
									</p>
								{/if}
							</div>
						</label>

						<!-- Speed Control for Historical Mode -->
						{#if enableHistoricalMode && !marketStatus.is_open}
							<div class="mt-4 pt-4 border-t border-gray-200">
								<label for="replay-speed" class="block text-sm font-medium text-gray-700 mb-2">
									Replay Speed: {replaySpeed}x
								</label>
								<div class="flex items-center gap-4">
									<input
										id="replay-speed"
										type="range"
										min="0.1"
										max="5.0"
										step="0.1"
										bind:value={replaySpeed}
										class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
									/>
									<div class="flex gap-2">
										<button
											on:click={() => replaySpeed = 0.5}
											class="px-3 py-1 text-xs bg-gray-200 hover:bg-gray-300 rounded"
										>
											0.5x
										</button>
										<button
											on:click={() => replaySpeed = 1.0}
											class="px-3 py-1 text-xs bg-blue-600 text-white hover:bg-blue-700 rounded"
										>
											1.0x
										</button>
										<button
											on:click={() => replaySpeed = 2.0}
											class="px-3 py-1 text-xs bg-gray-200 hover:bg-gray-300 rounded"
										>
											2.0x
										</button>
									</div>
								</div>
								<p class="text-xs text-gray-500 mt-1">
									Adjust replay speed: 0.5x = half speed, 1.0x = real-time, 2.0x = double speed
								</p>
							</div>

							<!-- Date Selection for Historical Mode -->
							<div class="mt-4 pt-4 border-t border-gray-200">
								<label for="historical-date" class="block text-sm font-medium text-gray-700 mb-2">
									Select Date for Historical Data
								</label>
								<input
									id="historical-date"
									type="date"
									bind:value={selectedDate}
									max={new Date().toISOString().split('T')[0]}
									class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
								/>
								<p class="text-xs text-gray-500 mt-1">
									Choose a trading day to replay. Leave empty for yesterday's data.
								</p>
							</div>
						{/if}
					</div>
				{:else if engineStatus.is_historical_mode}
					<div class="mb-4 p-3 bg-purple-50 border border-purple-200 rounded-lg">
						<div class="flex items-center gap-2">
							<span class="text-lg">üïí</span>
							<div class="flex-1">
								<p class="text-sm font-medium text-purple-900">Historical Simulation Active</p>
								<p class="text-xs text-purple-700">Replaying historical market data at {replaySpeed}x speed</p>
							</div>
						</div>
					</div>
				{/if}

				<div class="space-y-2">
					{#if !engineStatus.running}
						<button
							on:click={startEngine}
							disabled={loading || !selectedConfig}
							class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 font-semibold"
						>
							‚ñ∂ Start Trading
						</button>
					{:else if engineStatus.status === 'paused'}
						<button
							on:click={resumeEngine}
							disabled={loading}
							class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
						>
							‚ñ∂ Resume
						</button>
					{:else}
						<button
							on:click={pauseEngine}
							disabled={loading}
							class="w-full px-4 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 font-semibold"
						>
							‚è∏ Pause
						</button>
					{/if}

					{#if engineStatus.running}
						<button
							on:click={stopEngine}
							disabled={loading}
							class="w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold"
						>
							‚èπ Stop & Close All
						</button>
					{/if}
				</div>

				{#if engineStatus.running}
					<div class="mt-6 pt-6 border-t">
						<h3 class="text-sm font-semibold mb-3">Suspension Controls</h3>
						<div class="space-y-2">
							<label class="flex items-center gap-2">
								<input
									type="checkbox"
									checked={engineStatus.suspend_ce || false}
									on:change={(e) => toggleSuspendCE(e.target.checked)}
									class="w-5 h-5"
								/>
								<span class="text-sm">Suspend CE Entries</span>
							</label>
							<label class="flex items-center gap-2">
								<input
									type="checkbox"
									checked={engineStatus.suspend_pe || false}
									on:change={(e) => toggleSuspendPE(e.target.checked)}
									class="w-5 h-5"
								/>
								<span class="text-sm">Suspend PE Entries</span>
							</label>
						</div>
					</div>
				{/if}
			</div>

			<!-- Market Data -->
			<div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6">
				<div class="flex justify-between items-center mb-4">
					<h2 class="text-xl font-bold">Market Data</h2>
					<div class="text-sm font-medium {marketStatus.is_open ? 'text-green-600' : 'text-gray-500'}">
						{marketStatus.is_open ? 'üü¢ Market Open' : 'üî¥ Market Closed'}
					</div>
				</div>
				<div class="grid grid-cols-2 md:grid-cols-3 gap-4">
					<div class="bg-blue-50 rounded-lg p-4">
						<div class="text-sm text-gray-600 mb-1">NIFTY 50 LTP</div>
						<div class="text-2xl font-bold">{engineStatus.nifty_ltp ? formatCurrency(engineStatus.nifty_ltp) : '-'}</div>
					</div>
					<div class="bg-gray-50 rounded-lg p-4">
						<div class="text-sm text-gray-600 mb-1">Major Trend</div>
						<div class="text-lg font-bold {getTrendColor(engineStatus.major_trend)}">{engineStatus.major_trend || '-'}</div>
					</div>
					<div class="bg-gray-50 rounded-lg p-4">
						<div class="text-sm text-gray-600 mb-1">Minor Trend</div>
						<div class="text-lg font-bold {getTrendColor(engineStatus.minor_trend)}">{engineStatus.minor_trend || '-'}</div>
					</div>
					<div class="bg-purple-50 rounded-lg p-4">
						<div class="text-sm text-gray-600 mb-1">Active Positions</div>
						<div class="text-2xl font-bold text-purple-600">{engineStatus.active_positions || 0}</div>
					</div>
					<div class="bg-gray-50 rounded-lg p-4 md:col-span-2">
						<div class="text-sm text-gray-600 mb-1">Last Update</div>
						<div class="text-sm font-medium">{engineStatus.last_update ? formatDateTime(engineStatus.last_update) : 'No data yet'}</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Performance -->
		<div class="bg-white rounded-lg shadow-md p-6">
			<h2 class="text-xl font-bold mb-4">Performance</h2>
			<div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
				<div class="bg-gray-50 rounded-lg p-4">
					<div class="text-sm text-gray-600 mb-1">Initial Capital</div>
					<div class="text-lg font-bold">{formatCurrency(engineStatus.initial_capital)}</div>
				</div>
				<div class="bg-blue-50 rounded-lg p-4">
					<div class="text-sm text-gray-600 mb-1">Current Capital</div>
					<div class="text-lg font-bold text-blue-600">{formatCurrency(engineStatus.current_capital)}</div>
				</div>
				<div class="bg-purple-50 rounded-lg p-4">
					<div class="text-sm text-gray-600 mb-1">Total Trades</div>
					<div class="text-lg font-bold text-purple-600">{performance.total_trades}</div>
				</div>
				<div class="bg-gray-50 rounded-lg p-4">
					<div class="text-sm text-gray-600 mb-1">Realized P&L</div>
					<div class="text-lg font-bold {getPnLColor(performance.realized_pnl)}">{formatCurrency(performance.realized_pnl)}</div>
				</div>
				<div class="bg-gray-50 rounded-lg p-4">
					<div class="text-sm text-gray-600 mb-1">Unrealized P&L</div>
					<div class="text-lg font-bold {getPnLColor(performance.unrealized_pnl)}">{formatCurrency(performance.unrealized_pnl)}</div>
				</div>
				<div class="bg-gray-50 rounded-lg p-4">
					<div class="text-sm text-gray-600 mb-1">Total P&L</div>
					<div class="text-lg font-bold {getPnLColor(performance.total_pnl)}">{formatCurrency(performance.total_pnl)}</div>
				</div>
				<div class="bg-gray-50 rounded-lg p-4">
					<div class="text-sm text-gray-600 mb-1">Win Rate</div>
					<div class="text-lg font-bold text-gray-900">{performance.win_rate}%</div>
				</div>
			</div>
		</div>
	{/if}

	<!-- Trades Tab -->
	{#if mainTab === 'trades'}
		<div class="bg-white rounded-lg shadow-md">
			<!-- Subtab Headers -->
			<div class="border-b border-gray-200">
				<div class="flex gap-1 p-2">
					<button
						on:click={() => activeTab = 'performance'}
						class="px-6 py-3 rounded-t-lg font-medium transition-colors {activeTab === 'performance' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}"
					>
						üìä Active Positions ({activeTrades.length})
					</button>
					<button
						on:click={() => activeTab = 'closed'}
						class="px-6 py-3 rounded-t-lg font-medium transition-colors {activeTab === 'closed' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}"
					>
						üìù Closed Trades ({closedTrades.length})
					</button>
					<button
						on:click={() => activeTab = 'alerts'}
						class="px-6 py-3 rounded-t-lg font-medium transition-colors {activeTab === 'alerts' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}"
					>
						üîî Alerts ({alerts.length})
					</button>
				</div>
			</div>

			<!-- Subtab Content -->
			<div class="p-6">
				{#if activeTab === 'performance'}
					<!-- Active Positions -->
					{#if activeTrades.length === 0}
						<div class="text-center py-12 text-gray-500">
							No active positions
						</div>
					{:else}
						<div class="overflow-x-auto">
							<table class="w-full">
								<thead class="bg-gray-50">
									<tr>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Time</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Instrument</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Type</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Trigger</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Entry</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Current</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Target</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Stop Loss</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Qty</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">P&L</th>
										<th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">Action</th>
									</tr>
								</thead>
								<tbody class="divide-y divide-gray-200">
									{#each activeTrades as trade}
										<tr class="hover:bg-gray-50">
											<td class="px-4 py-3 text-sm text-gray-700">{formatTime(trade.entry_time)}</td>
											<td class="px-4 py-3 text-sm font-medium text-gray-900">{trade.instrument}</td>
											<td class="px-4 py-3">
												<span class="px-2 py-1 text-xs font-semibold rounded {trade.option_type === 'CE' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
													{trade.option_type}
												</span>
											</td>
											<td class="px-4 py-3 text-sm text-gray-700">{trade.entry_trigger?.toUpperCase() || '-'}</td>
											<td class="px-4 py-3 text-sm text-right text-gray-700">{formatCurrency(trade.entry_price)}</td>
											<td class="px-4 py-3 text-sm text-right font-medium text-gray-900">{formatCurrency(trade.current_price || trade.entry_price)}</td>
											<td class="px-4 py-3 text-sm text-right text-green-600">{formatCurrency(trade.target_price)}</td>
											<td class="px-4 py-3 text-sm text-right text-red-600">{formatCurrency(trade.stoploss_price)}</td>
											<td class="px-4 py-3 text-sm text-right text-gray-700">{trade.quantity}</td>
											<td class="px-4 py-3 text-sm text-right font-bold {getPnLColor(trade.unrealized_pnl || 0)}">
												{formatCurrency(trade.unrealized_pnl || 0)}
											</td>
											<td class="px-4 py-3 text-center">
												<button
													on:click={() => closePosition(trade.id)}
													class="px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700"
												>
													Close
												</button>
											</td>
										</tr>
									{/each}
								</tbody>
							</table>
						</div>
					{/if}
				{:else if activeTab === 'closed'}
					<!-- Closed Trades -->
					{#if closedTrades.length === 0}
						<div class="text-center py-12 text-gray-500">
							No closed trades yet
						</div>
					{:else}
						<div class="overflow-x-auto">
							<table class="w-full">
								<thead class="bg-gray-50">
									<tr>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Entry</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Exit</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Instrument</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Type</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Trigger</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Entry Price</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Exit Price</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Qty</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Exit Reason</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">P&L</th>
										<th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">P&L %</th>
									</tr>
								</thead>
								<tbody class="divide-y divide-gray-200">
									{#each closedTrades as trade}
										<tr class="hover:bg-gray-50">
											<td class="px-4 py-3 text-sm text-gray-700">{formatTime(trade.entry_time)}</td>
											<td class="px-4 py-3 text-sm text-gray-700">{formatTime(trade.exit_time)}</td>
											<td class="px-4 py-3 text-sm font-medium text-gray-900">{trade.instrument}</td>
											<td class="px-4 py-3">
												<span class="px-2 py-1 text-xs font-semibold rounded {trade.option_type === 'CE' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
													{trade.option_type}
												</span>
											</td>
											<td class="px-4 py-3 text-sm text-gray-700">{trade.entry_trigger?.toUpperCase() || '-'}</td>
											<td class="px-4 py-3 text-sm text-right text-gray-700">{formatCurrency(trade.entry_price)}</td>
											<td class="px-4 py-3 text-sm text-right text-gray-700">{formatCurrency(trade.exit_price)}</td>
											<td class="px-4 py-3 text-sm text-right text-gray-700">{trade.quantity}</td>
											<td class="px-4 py-3">
												<span class="px-2 py-1 text-xs font-semibold rounded {
													trade.exit_reason === 'target' ? 'bg-green-100 text-green-700' :
													trade.exit_reason === 'stoploss' ? 'bg-red-100 text-red-700' :
													'bg-yellow-100 text-yellow-700'
												}">
													{trade.exit_reason}
												</span>
											</td>
											<td class="px-4 py-3 text-sm text-right font-bold {getPnLColor(trade.pnl)}">
												{formatCurrency(trade.pnl)}
											</td>
											<td class="px-4 py-3 text-sm text-right font-bold {getPnLColor(trade.pnl_percentage)}">
												{trade.pnl_percentage?.toFixed(2)}%
											</td>
										</tr>
									{/each}
								</tbody>
							</table>
						</div>
					{/if}
				{:else if activeTab === 'alerts'}
					<!-- Alerts -->
					{#if alerts.length === 0}
						<div class="text-center py-12 text-gray-500">
							No alerts yet
						</div>
					{:else}
						<div class="space-y-2 max-h-96 overflow-y-auto">
							{#each alerts as alert}
								<div class="flex items-start gap-3 p-3 rounded-lg {
									alert.alert_type === 'entry' ? 'bg-green-50' :
									alert.alert_type === 'exit' ? 'bg-blue-50' :
									alert.alert_type === 'error' ? 'bg-red-50' :
									'bg-gray-50'
								}">
									<span class="text-xl">
										{alert.alert_type === 'entry' ? 'üìà' :
										 alert.alert_type === 'exit' ? 'üìâ' :
										 alert.alert_type === 'error' ? '‚ö†Ô∏è' :
										 '‚ÑπÔ∏è'}
									</span>
									<div class="flex-1">
										<div class="text-sm font-medium text-gray-900">{alert.message}</div>
										<div class="text-xs text-gray-600 mt-1">{formatDateTime(alert.timestamp)}</div>
									</div>
								</div>
							{/each}
						</div>
					{/if}
				{/if}
			</div>
		</div>
	{/if}

	<!-- Configurations Tab -->
	{#if mainTab === 'configs'}
		<div class="space-y-6">
			<!-- Header -->
			<div class="flex justify-between items-center">
				<div>
					<h2 class="text-xl font-bold">Configuration Management</h2>
					<p class="text-gray-600">Create, edit, and manage paper trade configurations</p>
				</div>
				<button
					on:click={newConfig}
					class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
				>
					‚ûï New Configuration
				</button>
			</div>

			<!-- Configuration Form -->
			{#if showConfigForm}
				<div class="bg-white rounded-lg shadow-md p-6">
					<h3 class="text-lg font-bold mb-4">
						{editingConfig ? 'Edit Configuration' : 'Create New Configuration'}
					</h3>
					
					<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
						<!-- Basic Settings -->
						<div class="md:col-span-2 lg:col-span-3">
							<label for="config-name" class="block text-sm font-medium text-gray-700 mb-1">Configuration Name</label>
							<input
								id="config-name"
								type="text"
								bind:value={configForm.name}
								placeholder="e.g., Conservative Strategy"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div>
							<label for="initial-capital" class="block text-sm font-medium text-gray-700 mb-1">Initial Capital (‚Çπ)</label>
							<input
								id="initial-capital"
								type="number"
								bind:value={configForm.initial_capital}
								min="10000"
								step="1000"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div>
							<label for="capital-allocation" class="block text-sm font-medium text-gray-700 mb-1">Capital Allocation (%)</label>
							<input
								id="capital-allocation"
								type="number"
								bind:value={configForm.capital_allocation_pct}
								min="1"
								max="100"
								step="1"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div>
							<label for="replay-speed-config" class="block text-sm font-medium text-gray-700 mb-1">Replay Speed</label>
							<input
								id="replay-speed-config"
								type="number"
								bind:value={configForm.replay_speed}
								min="0.1"
								max="5.0"
								step="0.1"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<!-- MA Settings -->
						<div class="md:col-span-2 lg:col-span-3">
							<h4 class="text-md font-semibold mb-2">Moving Average Settings</h4>
						</div>

						<div>
							<label for="ma-short-period" class="block text-sm font-medium text-gray-700 mb-1">Short MA Period</label>
							<input
								id="ma-short-period"
								type="number"
								bind:value={configForm.ma_short_period}
								min="3"
								max="50"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div>
							<label for="ma-long-period" class="block text-sm font-medium text-gray-700 mb-1">Long MA Period</label>
							<input
								id="ma-long-period"
								type="number"
								bind:value={configForm.ma_long_period}
								min="5"
								max="200"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div>
							<label for="major-trend-timeframe" class="block text-sm font-medium text-gray-700 mb-1">Major Trend Timeframe</label>
							<select
								id="major-trend-timeframe"
								bind:value={configForm.major_trend_timeframe}
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							>
								<option value="15min">15 Minutes</option>
								<option value="30min">30 Minutes</option>
								<option value="60min">1 Hour</option>
							</select>
						</div>

						<div>
							<label for="minor-trend-timeframe" class="block text-sm font-medium text-gray-700 mb-1">Minor Trend Timeframe</label>
							<select
								id="minor-trend-timeframe"
								bind:value={configForm.minor_trend_timeframe}
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							>
								<option value="1min">1 Minute</option>
								<option value="3min">3 Minutes</option>
								<option value="5min">5 Minutes</option>
							</select>
						</div>

						<!-- Trading Triggers -->
						<div class="md:col-span-2 lg:col-span-3">
							<h4 class="text-md font-semibold mb-2">Trading Triggers</h4>
						</div>

						<!-- 7MA Settings -->
						<div class="md:col-span-2 lg:col-span-3 bg-gray-50 p-3 rounded-lg">
							<div class="flex items-center gap-2 mb-2">
								<input
									type="checkbox"
									bind:checked={configForm.buy_7ma_enabled}
									class="w-4 h-4"
								/>
								<span class="font-medium">7MA Crossover</span>
							</div>
							{#if configForm.buy_7ma_enabled}
								<div class="grid grid-cols-3 gap-2">
									<div>
										<label for="buy-7ma-percentage-below" class="block text-xs text-gray-600 mb-1">% Below</label>
										<input
											id="buy-7ma-percentage-below"
											type="number"
											bind:value={configForm.buy_7ma_percentage_below}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
									<div>
										<label for="buy-7ma-target-percentage" class="block text-xs text-gray-600 mb-1">Target %</label>
										<input
											id="buy-7ma-target-percentage"
											type="number"
											bind:value={configForm.buy_7ma_target_percentage}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
									<div>
										<label for="buy-7ma-stoploss-percentage" class="block text-xs text-gray-600 mb-1">Stop Loss %</label>
										<input
											id="buy-7ma-stoploss-percentage"
											type="number"
											bind:value={configForm.buy_7ma_stoploss_percentage}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
								</div>
							{/if}
						</div>

						<!-- 20MA Settings -->
						<div class="md:col-span-2 lg:col-span-3 bg-gray-50 p-3 rounded-lg">
							<div class="flex items-center gap-2 mb-2">
								<input
									type="checkbox"
									bind:checked={configForm.buy_20ma_enabled}
									class="w-4 h-4"
								/>
								<span class="font-medium">20MA Crossover</span>
							</div>
							{#if configForm.buy_20ma_enabled}
								<div class="grid grid-cols-3 gap-2">
									<div>
										<label for="buy-20ma-percentage-below" class="block text-xs text-gray-600 mb-1">% Below</label>
										<input
											id="buy-20ma-percentage-below"
											type="number"
											bind:value={configForm.buy_20ma_percentage_below}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
									<div>
										<label for="buy-20ma-target-percentage" class="block text-xs text-gray-600 mb-1">Target %</label>
										<input
											id="buy-20ma-target-percentage"
											type="number"
											bind:value={configForm.buy_20ma_target_percentage}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
									<div>
										<label for="buy-20ma-stoploss-percentage" class="block text-xs text-gray-600 mb-1">Stop Loss %</label>
										<input
											id="buy-20ma-stoploss-percentage"
											type="number"
											bind:value={configForm.buy_20ma_stoploss_percentage}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
								</div>
							{/if}
						</div>

						<!-- LBB Settings -->
						<div class="md:col-span-2 lg:col-span-3 bg-gray-50 p-3 rounded-lg">
							<div class="flex items-center gap-2 mb-2">
								<input
									type="checkbox"
									bind:checked={configForm.buy_lbb_enabled}
									class="w-4 h-4"
								/>
								<span class="font-medium">Lower Bollinger Band</span>
							</div>
							{#if configForm.buy_lbb_enabled}
								<div class="grid grid-cols-3 gap-2">
									<div>
										<label for="buy-lbb-percentage-below" class="block text-xs text-gray-600 mb-1">% Below</label>
										<input
											id="buy-lbb-percentage-below"
											type="number"
											bind:value={configForm.buy_lbb_percentage_below}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
									<div>
										<label for="buy-lbb-target-percentage" class="block text-xs text-gray-600 mb-1">Target %</label>
										<input
											id="buy-lbb-target-percentage"
											type="number"
											bind:value={configForm.buy_lbb_target_percentage}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
									<div>
										<label for="buy-lbb-stoploss-percentage" class="block text-xs text-gray-600 mb-1">Stop Loss %</label>
										<input
											id="buy-lbb-stoploss-percentage"
											type="number"
											bind:value={configForm.buy_lbb_stoploss_percentage}
											step="0.1"
											class="w-full px-2 py-1 text-sm border border-gray-300 rounded"
										/>
									</div>
								</div>
							{/if}
						</div>

						<!-- Position Sizing -->
						<div class="md:col-span-2 lg:col-span-3">
							<h4 class="text-md font-semibold mb-2">Position Sizing</h4>
						</div>

						<div>
							<label for="lot-size" class="block text-sm font-medium text-gray-700 mb-1">Lot Size</label>
							<input
								id="lot-size"
								type="number"
								bind:value={configForm.lot_size}
								min="1"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div>
							<label for="min-strike-gap" class="block text-sm font-medium text-gray-700 mb-1">Min Strike Gap</label>
							<input
								id="min-strike-gap"
								type="number"
								bind:value={configForm.min_strike_gap}
								min="50"
								step="50"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div>
							<label for="strike-round-to" class="block text-sm font-medium text-gray-700 mb-1">Strike Round To</label>
							<input
								id="strike-round-to"
								type="number"
								bind:value={configForm.strike_round_to}
								min="50"
								step="50"
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<!-- Risk Management -->
						<div class="md:col-span-2 lg:col-span-3">
							<h4 class="text-md font-semibold mb-2">Risk Management</h4>
						</div>

						<div>
							<label for="square-off-time" class="block text-sm font-medium text-gray-700 mb-1">Square Off Time</label>
							<input
								id="square-off-time"
								type="time"
								bind:value={configForm.square_off_time}
								class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
							/>
						</div>

						<div class="flex items-center gap-2">
							<input
								id="square-off-enabled"
								type="checkbox"
								bind:checked={configForm.square_off_enabled}
								class="w-4 h-4"
							/>
							<label for="square-off-enabled" class="text-sm font-medium text-gray-700">Enable Square Off</label>
						</div>

						<div class="flex items-center gap-2">
							<input
								id="exclude-expiry-day-contracts"
								type="checkbox"
								bind:checked={configForm.exclude_expiry_day_contracts}
								class="w-4 h-4"
							/>
							<label for="exclude-expiry-day-contracts" class="text-sm font-medium text-gray-700">Exclude Expiry Day Contracts</label>
						</div>

						<div class="flex items-center gap-2">
							<input
								id="reverse-signals"
								type="checkbox"
								bind:checked={configForm.reverse_signals}
								class="w-4 h-4"
							/>
							<label for="reverse-signals" class="text-sm font-medium text-gray-700">Reverse Signals</label>
						</div>

						<div class="flex items-center gap-2">
							<input
								id="suspend-ce"
								type="checkbox"
								bind:checked={configForm.suspend_ce}
								class="w-4 h-4"
							/>
							<label for="suspend-ce" class="text-sm font-medium text-gray-700">Suspend CE Entries</label>
						</div>

						<div class="flex items-center gap-2">
							<input
								id="suspend-pe"
								type="checkbox"
								bind:checked={configForm.suspend_pe}
								class="w-4 h-4"
							/>
							<label for="suspend-pe" class="text-sm font-medium text-gray-700">Suspend PE Entries</label>
						</div>
					</div>

					<!-- Form Actions -->
					<div class="flex gap-3 mt-6 pt-4 border-t">
						<button
							on:click={editingConfig ? updateConfig : createConfig}
							class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
						>
							{editingConfig ? 'Update Configuration' : 'Create Configuration'}
						</button>
						<button
							on:click={() => { showConfigForm = false; resetConfigForm(); }}
							class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700"
						>
							Cancel
						</button>
					</div>
				</div>
			{/if}

			<!-- Configurations List -->
			<div class="bg-white rounded-lg shadow-md">
				<div class="p-6">
					<h3 class="text-lg font-bold mb-4">Your Configurations</h3>
					
					{#if configs.length === 0}
						<div class="text-center py-12 text-gray-500">
							No configurations found. Create your first configuration to get started.
						</div>
					{:else}
						<div class="overflow-x-auto">
							<table class="w-full">
								<thead class="bg-gray-50">
									<tr>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Name</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Capital</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
										<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Created</th>
										<th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">Actions</th>
									</tr>
								</thead>
								<tbody class="divide-y divide-gray-200">
									{#each configs as config}
										<tr class="hover:bg-gray-50">
											<td class="px-4 py-3 text-sm font-medium text-gray-900">{config.name}</td>
											<td class="px-4 py-3 text-sm text-gray-700">{formatCurrency(config.initial_capital)}</td>
											<td class="px-4 py-3">
												<span class="px-2 py-1 text-xs font-semibold rounded {
													config.status === 'running' ? 'bg-green-100 text-green-700' :
													config.status === 'paused' ? 'bg-yellow-100 text-yellow-700' :
													'bg-gray-100 text-gray-700'
												}">
													{config.status.toUpperCase()}
												</span>
											</td>
											<td class="px-4 py-3 text-sm text-gray-700">{formatDateTime(config.created_at)}</td>
											<td class="px-4 py-3 text-center space-x-2">
												<button
													on:click={() => editConfig(config)}
													disabled={config.status === 'running'}
													class="px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-300"
												>
													Edit
												</button>
												<button
													on:click={() => deleteConfig(config.id)}
													disabled={config.status === 'running'}
													class="px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 disabled:bg-gray-300"
												>
													Delete
												</button>
											</td>
										</tr>
									{/each}
								</tbody>
							</table>
						</div>
					{/if}
				</div>
			</div>
		</div>
	{/if}
</div>
