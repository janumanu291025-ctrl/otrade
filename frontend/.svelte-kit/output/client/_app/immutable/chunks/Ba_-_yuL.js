import{w as u}from"./CinR6i2W.js";const y="http://localhost:8000";function d(){const{subscribe:c,set:f,update:r}=u({ltp:0,day_open:0,day_high:0,day_low:0,prev_close:0,timestamp:null,timeframes:{},loading:!1,error:null,lastUpdate:null});let a=null,s=!1;function l(){const e=new Date,t=e.getHours(),n=e.getMinutes(),i=t*60+n,m=9*60+15,p=15*60+30;return i>=m&&i<=p}async function o(){try{const e=await fetch(`${y}/api/strategy/timeframe-analysis`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();t.status==="success"&&t.data&&r(n=>({...n,ltp:t.data.ltp,day_open:t.data.day_open||0,day_high:t.data.day_high||0,day_low:t.data.day_low||0,prev_close:t.data.prev_close||0,timestamp:t.data.timestamp,timeframes:t.data.timeframes,lastUpdate:new Date,error:null}))}catch(e){console.error("Error fetching timeframe analysis:",e),r(t=>({...t,error:e.message}))}}return{subscribe:c,async initialize(){await o(),s=l();const e=1e3;a&&clearInterval(a),a=setInterval(async()=>{s=l(),await o()},e)},async refresh(){await o()},destroy(){a&&(clearInterval(a),a=null)},updateFromWebSocket(e){e&&e.ltp!==void 0&&r(t=>({...t,ltp:e.ltp,day_open:e.day_open||t.day_open,day_high:e.day_high||t.day_high,day_low:e.day_low||t.day_low,prev_close:e.prev_close||t.prev_close,timestamp:e.timestamp,timeframes:e.timeframes||t.timeframes,lastUpdate:new Date}))}}}const h=d();export{h as timeframeAnalysis};
